<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üêç Fil vs Burolashka üç≠</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --box: 20px; --cells: 18; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; background: #0f1020; color: #f3f3f3;
      font-family: system-ui, -apple-system, Arial, sans-serif;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh; user-select: none;
      background-image: radial-gradient(1000px 600px at 50% -20%, #4b008233, transparent),
                        radial-gradient(800px 400px at -20% 60%, #00ffaa22, transparent);
    }
    h1 { margin: 12px 0; font-size: 24px; }
    #score { font-size: 18px; margin-bottom: 8px; }
    canvas { background: #0a0b18; border: 3px solid #2d3159; border-radius: 10px; }
    #start, #over {
      position: fixed; inset: 0; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: rgba(15, 16, 32, 0.95); text-align: center;
    }
    #play, #restart {
      padding: 14px 24px; background: #2e7d32; color: #fff;
      font-size: 20px; border: none; border-radius: 12px;
      cursor: pointer; margin-top: 16px;
    }
    #play:hover, #restart:hover { background: #3aa042; }
    .pad {
      position: fixed; bottom: 16px; left: 0; right: 0;
      display: grid; grid-template-columns: 64px 64px 64px;
      grid-template-rows: 64px 64px 64px; gap: 8px;
      place-items: center; justify-content: center;
      pointer-events: none;
    }
    .pad button {
      pointer-events: auto; width: 64px; height: 64px;
      border-radius: 12px; border: 2px solid #2d3159;
      background: #1b1d36; color: #fff; font-size: 22px;
    }
    .pad .empty { opacity: 0; }
  </style>
</head>
<body>
  <h1>üêç Fil & Burolashka üç≠</h1>
  <div id="score">Score: 0</div>
  <canvas id="game" width="360" height="360"></canvas>

  <!-- Start Screen -->
  <div id="start">
    <h2>Help Fil üêç eat Burolashkas üç≠</h2>
    <p>Swipe or use arrows to move.<br>Don't hit walls or yourself!</p>
    <button id="play">‚ñ∂Ô∏è Play</button>
  </div>

  <!-- Game Over Screen -->
  <div id="over" style="display:none;">
    <h2>üíÄ Game Over!</h2>
    <p id="finalScore"></p>
    <button id="restart">üîÅ Play Again</button>
  </div>

  <!-- On-screen Controls -->
  <div class="pad" aria-hidden="true">
    <span class="empty"></span><button id="up">‚ñ≤</button><span class="empty"></span>
    <button id="left">‚óÄ</button><span class="empty"></span><button id="right">‚ñ∂</button>
    <span class="empty"></span><button id="down">‚ñº</button><span class="empty"></span>
  </div>

  <script>
    // Telegram Mini App (optional)
    const tg = window.Telegram?.WebApp || {};
    tg.ready?.();
    tg.expand?.();

    const BOX = 20, CELLS = 18, SIZE = BOX * CELLS;
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let snake, dir, food, score, gameOver = false, timer;

    const startScreen = document.getElementById("start");
    const overScreen = document.getElementById("over");
    const finalScoreEl = document.getElementById("finalScore");

    function init() {
      snake = [{ x: 9 * BOX, y: 9 * BOX }];
      dir = "RIGHT";
      food = randomFood();
      score = 0;
      gameOver = false;
      document.getElementById("score").textContent = "Score: 0";
      clearInterval(timer);
      draw();
    }

    function startGame() {
      startScreen.style.display = "none";
      overScreen.style.display = "none";
      init();
      timer = setInterval(loop, 130);
    }

    function endGame() {
      clearInterval(timer);
      gameOver = true;
      finalScoreEl.textContent = `Final score: ${score}`;
      overScreen.style.display = "flex";
    }

    function loop() {
      if (gameOver) return;

      let nx = snake[0].x;
      let ny = snake[0].y;

      if (dir === "LEFT") nx -= BOX;
      if (dir === "RIGHT") nx += BOX;
      if (dir === "UP") ny -= BOX;
      if (dir === "DOWN") ny += BOX;

      if (nx < 0 || ny < 0 || nx >= SIZE || ny >= SIZE || collide({ x: nx, y: ny }, snake)) {
        endGame();
        return;
      }

      if (nx === food.x && ny === food.y) {
        score++;
        document.getElementById("score").textContent = `Score: ${score}`;
        food = randomFood();
      } else {
        snake.pop();
      }

      snake.unshift({ x: nx, y: ny });
      draw();
    }

    function draw() {
      ctx.fillStyle = "#0a0b18";
      ctx.fillRect(0, 0, SIZE, SIZE);

      // Draw food üç≠
      ctx.font = "20px system-ui, Apple Color Emoji";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("üç≠", food.x + BOX / 2, food.y + BOX / 2);

      // Draw snake üêç Fil
      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = i === 0 ? "#39ff14" : "#00cc44";
        ctx.fillRect(snake[i].x, snake[i].y, BOX, BOX);
      }
    }

    function randomFood() {
      return {
        x: Math.floor(Math.random() * CELLS) * BOX,
        y: Math.floor(Math.random() * CELLS) * BOX,
      };
    }

    function collide(head, arr) {
      return arr.some((s) => s.x === head.x && s.y === head.y);
    }

    // Controls (keyboard)
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft" && dir !== "RIGHT") dir = "LEFT";
      if (e.key === "ArrowRight" && dir !== "LEFT") dir = "RIGHT";
      if (e.key === "ArrowUp" && dir !== "DOWN") dir = "UP";
      if (e.key === "ArrowDown" && dir !== "UP") dir = "DOWN";
    });

    // Touch swipe
    let sx = 0, sy = 0;
    canvas.addEventListener("touchstart", (e) => {
      const t = e.changedTouches[0];
      sx = t.clientX; sy = t.clientY;
    }, { passive: true });

    canvas.addEventListener("touchend", (e) => {
      const t = e.changedTouches[0];
      const dx = t.clientX - sx;
      const dy = t.clientY - sy;
      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && dir !== "LEFT") dir = "RIGHT";
        if (dx < 0 && dir !== "RIGHT") dir = "LEFT";
      } else {
        if (dy > 0 && dir !== "UP") dir = "DOWN";
        if (dy < 0 && dir !== "DOWN") dir = "UP";
      }
    }, { passive: true });

    // On-screen buttons
    [["up", "UP"], ["down", "DOWN"], ["left", "LEFT"], ["right", "RIGHT"]].forEach(([id, d]) => {
      document.getElementById(id).addEventListener("click", () => {
        if (d === "LEFT" && dir !== "RIGHT") dir = "LEFT";
        if (d === "RIGHT" && dir !== "LEFT") dir = "RIGHT";
        if (d === "UP" && dir !== "DOWN") dir = "UP";
        if (d === "DOWN" && dir !== "UP") dir = "DOWN";
      });
    });

    // Buttons
    document.getElementById("play").addEventListener("click", startGame);
    document.getElementById("restart").addEventListener("click", startGame);

    // Initial render
    init();
  </script>
</body>
</html>
